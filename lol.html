<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component@1.3.3/dist/aframe-environment-component.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <title>Lenape man in Amsterdam</title>
</head>
<body>
    <a-scene>
        <!-- assets -->
        <a-assets>
            <a-asset-item id="watcher" src="Assets/Models/Watcher.glb"></a-asset-item>
            <a-asset-item id="characterModel" src="/Assets/Models/Watcher.glb"></a-asset-item>
            
            <img id="groundText" src="/Assets/Img/ground.webp">
            <img id="boxText" src="/Assets/Img/doos.webp">
            <img id="skyText" src="/Assets/Img/skybox.webp">
            <img id="skyNightText" src="/Assets/Img/skybox.webp">
            
            <!-- Add sound asset -->
            <audio id="backgroundSound" src="/Assets/Sound/BOambience.mp3"></audio>
        </a-assets>
        
        <!-- sky -->
        <a-sky id="sky" material="src: #skyNightText; repeat: 2 2" rotation="0 -90 0"></a-sky>

        <!-- Terrain -->
        <a-plane material="src: #groundText; repeat: 20 20 20" width="110" height="80" color="grey" position="-0.5 0 -10" rotation="-90 0 0"></a-plane>

        <!-- Water1 -->
        <a-box id="water1" width="10" height="2" depth="9.3" position="-47 0 -2.7" material="shader: flat; color: #0000FF; opacity: 0.7;"></a-box>

        <!-- Water2 -->
        <a-box id="water2" width="16" height="2" depth="9.3" position="-24 0 24.25" material="shader: flat; color: #0000FF; opacity: 0.7;"></a-box>
        
        <!-- Water3 -->
        <a-box id="water3" width="18" height="2" depth="9.3" position="34 0 -50.25" material="shader: flat; color: #0000FF; opacity: 0.7;"></a-box>
        <!-- Water3 -->
        <a-box id="water3" width="3" height="1" depth="9.3" rotation="0 87.5 0" position="57 0 1.25" material="shader: flat; color: #0000FF; opacity: 0.7;"></a-box>

        <!-- bar front -->
        <a-cylinder radius="0.1" height="4" color="#999" position="1.5 2 -2.5"></a-cylinder>       
               
        <!-- bars left -->
        <a-cylinder radius="0.1" height="4" color="#999" position="-1.5 2 -2.3" rotation="0 90 0"></a-cylinder>
        <a-cylinder radius="0.1" height="4" color="#999" position="-1.5 2 0.5" rotation="0 90 0"></a-cylinder>
       
        <!-- bar right -->
        <a-cylinder radius="0.1" height="4" color="#999" position="1.5 2 0.5" rotation="0 90 0"></a-cylinder>

        <a-box width="3.5" height="0.1" depth="3" color="grey" position="0 4 -1"></a-box>

        <!-- Boxes -->
        <a-entity id="box1" geometry="primitive: box" material="src: #boxText" position="1.5 1.5 1.5" rotation="0 59 0"></a-entity>
        <a-entity id="box2" geometry="primitive: box" material="src: #boxText" position="0.6 0.5 1.5" rotation="0 0 0"></a-entity>
        <a-entity id="box3" geometry="primitive: box" material="src: #boxText" position="2 0.5 1.5" rotation="0 15 0"></a-entity>
        <a-entity id="box4" geometry="primitive: box" material="src: #boxText" position="0.3 1.5 1.5" rotation="0 31 0"></a-entity>
        <a-entity id="box5" geometry="primitive: box" material="src: #boxText" position="-0.6 0.5 1.5" rotation="0 5 0"></a-entity>
        <a-entity id="box6" geometry="primitive: box" material="src: #boxText" position="-2 0.5 1.5" rotation="0 10 0"></a-entity>
        <a-entity id="box7" geometry="primitive: box" material="src: #boxText" position="-1.2 1.5 1.5" rotation="0 72 0"></a-entity>
        <a-entity id="box8" geometry="primitive: box" material="src: #boxText" position="1 2.5 1.5" rotation="0 25 0"></a-entity>
        <a-entity id="box9" geometry="primitive: box" material="src: #boxText" position="-0.5 2.5 1.5" rotation="0 43 0"></a-entity>
        <a-entity id="box10" geometry="primitive: box" material="src: #boxText" position="-4 0.5 1.5" rotation="0 75 0"></a-entity>
        <a-entity id="box11" geometry="primitive: box" material="src: #boxText" position="4 0.5 1.5" rotation="0 200 0"></a-entity>

        <!-- Buildings front -->    
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="-42 0 -50" rotation="0 -90 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #645d42" position="-24 0 -50" rotation="0 -90 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="4 0 -50" rotation="0 -90 0" depth="-5"></a-entity>

        <!-- Buildings left -->
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="-45 0 -26" rotation="0 360 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #645d42" position="-45 0 -5" rotation="0 360 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="-45 0 23" rotation="0 360 0" depth="-5"></a-entity>
        <a-entity gltf-model="models/amsterdambuilding.glb" change-material-color="color: #844e35" material="color: yellow" position="-45 -10" rotation="0 360 0" depth="-5"></a-entity>  

        <!-- Buildings Right -->
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="55 0 -48" rotation="0 -180 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="55 0 -29" rotation="0 -180 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #645d42" position="55 0 0" rotation="0 -180 0" depth="-5"></a-entity>

        <!-- Buildings Back -->
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #645d42" position="52 0 24" rotation="0 90 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #844e35" position="32 0 24" rotation="0 90 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/old amsterdam buildings.glb" change-material-color="color: #645d42" position="6 0 24" rotation="0 90 0" depth="-5"></a-entity>

        <!-- WAGEN -->
        <a-entity gltf-model="Assets/Models/WAGENnotexture.glb" change-material-color="color: #964B00" position="35 0 15" rotation="0 50 0" depth="-5"></a-entity>

        <!-- WAGEN2 -->
        <a-entity gltf-model="Assets/Models/WAGENnotexture.glb" change-material-color="color: #964B00" position="26.7 0 -15" rotation="0 55 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/Box2GrootNotexture.glb" position="21.5 1.2 -18.6 " rotation="0 55 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/Box2GrootNotexture.glb" position="21.5 1.7 -18.6 " rotation="0 55 0" depth="-5"></a-entity>

        <!-- WAGEN3 -->
        <!--<a-entity gltf-model="Assets/Models/WAGENnotexture.glb" change-material-color="color: #964B00" position="45 0 -25" rotation="0 50 0" depth="-5"></a-entity>-->

        <!-- Lamps -->
        <a-entity gltf-model="Assets/Models/LampPostBase.glb" change-material-color="color: #844e35" position="37 0 15" rotation="0 50 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/LampPostBase.glb" change-material-color="color: #645d42" position="-2 0 19" rotation="0 50 0" depth="-5"></a-entity>
        <a-entity gltf-model="Assets/Models/LampPostBase.glb" change-material-color="color: #844e35" position="-40 0 17" rotation="0 50 0" depth="-5"></a-entity>

        <!-- Standing next to WAGEN --> 
        <a-entity gltf-model="Assets/Models/Watcher.glb" position="30 0 15" animation-mixer></a-entity>

        <!-- Rows of characters -->
        <script>
            AFRAME.registerComponent('rows-of-characters', {
                init: function () {
                    const sceneEl = this.el;
                    const rowCount = 4; 
                    const initialRadius = 5; 
                    const radiusStep = 4; 
                    const characterCountPerRow = 8; 
                    const angleStep = (-1 * Math.PI) / characterCountPerRow;

                    for (let row = 0; row < rowCount; row++) {
                        const radius = initialRadius + (row * radiusStep);
                        for (let i = 0; i < characterCountPerRow; i++) {
                            const angle = i * angleStep;
                            const x = radius * Math.cos(angle);
                            const z = radius * Math.sin(angle);
                            const dx = 0 - x;
                            const dz = 1.5 - z;
                            const rotationY = Math.atan2(dx, dz) * 180 / Math.PI;

                            const characterEl = document.createElement('a-entity');
                            characterEl.setAttribute('gltf-model', '#characterModel');
                            characterEl.setAttribute('position', { x: x, y:-0.03, z: z });
                            characterEl.setAttribute('rotation', { x: 0, y: rotationY, z: 0 });
                            characterEl.setAttribute('animation-mixer', '');
                            sceneEl.appendChild(characterEl);
                        }
                    }
                }
            });

            AFRAME.registerComponent('multiple-characters', {
                init: function () {
                    const sceneEl = this.el;
                    const characterCount = 4;
                    const initialZ = -30;
                    const maxZ = -50;
                    const minX = -20;
                    const maxX = 20;
                    
                    for (let i = 0; i < characterCount; i++) {
                        const z = initialZ - Math.random() * (initialZ - maxZ);
                        const x = minX + Math.random() * (maxX - minX);
                        const entity = document.createElement('a-entity');
                        entity.setAttribute('gltf-model', '#characterModel');
                        entity.setAttribute('position', { x: x, y: -0.10, z: z });
                        entity.setAttribute('animation-mixer', '');
                        entity.setAttribute('animation', `property: position; to: ${x} 0 1.5; dur: 32500; easing: linear; loop: true`);
                        sceneEl.appendChild(entity);
                    }
                }
            });

            // Custom component to change material color
            AFRAME.registerComponent('change-material-color', {
                schema: {
                    color: {type: 'color', default: '#FFF'}
                },
                init: function () {
                    const model = this.el.getObject3D('mesh');
                    if (model) {
                        this.changeColor(model);
                    } else {
                        this.el.addEventListener('model-loaded', (e) => {
                            this.changeColor(e.detail.model);
                        });
                    }
                },
                changeColor: function (model) {
                    model.traverse((node) => {
                        if (node.isMesh) {
                            node.material.color.set(this.data.color);
                        }
                    });
                }
            });
        </script>
        
        <a-entity rows-of-characters></a-entity>
        <a-entity multiple-characters></a-entity>

        <!-- Background sound -->
        <a-sound src="#backgroundSound" autoplay="true" loop="true" volume="0"></a-sound>
        
        <!-- Applying the custom component to change the color -->
        <!--<a-entity gltf-model="#characterModel" change-material-color="color: #FF0000" position="0 0 0"></a-entity>-->
        
    </a-scene>
</body>
</html>
